<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Editor Markdown Avançado</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript">
        window.MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']]
          },
          startup: {
            ready: () => {
              MathJax.startup.defaultReady();
              MathJax.startup.promise.then(() => {
                // Add wrapper to LaTeX blocks after rendering
                setTimeout(wrapLatexBlocks, 500);
              });
            }
          }
        };
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-page: #0A0A0A;
            --bg-surface: #141414;
            --bg-surface-hover: #1A1A1A;
            --text-primary: #E4E4E7;
            --text-secondary: #A1A1AA;
            --text-tertiary: #52525B;
            --border-default: #27272A;
            --border-interactive: #3F3F46;
            --primary: #019875;
            --primary-hover: #02b48a;
            --accent: #3B82F6;
            
            /* Customizable settings */
            --h1-color: #019875;
            --h1-bg: transparent;
            --h2-color: #019875;
            --h2-bg: transparent;
            --h3-color: #019875;
            --h3-bg: transparent;
            --h4-color: #019875;
            --h4-bg: transparent;
            --h5-color: #019875;
            --h5-bg: transparent;
            --h6-color: #A1A1AA;
            --h6-bg: transparent;
            
            --code-inline-color: #3B82F6;
            --code-inline-bg: rgba(255, 255, 255, 0.05);
            --latex-inline-color: #E4E4E7;
            --latex-inline-bg: transparent;
            
            --quote-color: #A1A1AA;
            --quote-bg: rgba(1, 152, 117, 0.05);
            --quote-border: #019875;
            
            --latex-block-color: #1a1a2e;
            --latex-block-bg: #e3f2fd;
            --latex-block-border: #2196F3;
            
            --code-block-bg: #141414;
            --code-block-border: #019875;
            
            --spacing-horizontal: 0;
            --spacing-vertical: 1.7;
            --word-spacing: 0;
            --margins: 20px;
            --text-align: left;
            
            --font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            --h1-size: 2em;
            --h2-size: 1.6em;
            --h3-size: 1.3em;
            --h4-size: 1.1em;
            --h5-size: 1em;
            --h6-size: 0.9em;
            --p-size: 16px;
            --quote-size: 16px;
            
            --hr-color: #00ff88;
            --hr-thickness: 2px;
            --hr-style: solid;
            
            --table-header-bg: #019875;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: var(--bg-page);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
				
        /* Top Menu Bar */
        .top-menu {
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border-default);
            display: flex;
            align-items: center;
            padding: 10px 20px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .menu-title {
            font-weight: 600;
            font-size: 18px;
            background: linear-gradient(to right, var(--primary), var(--primary-hover));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-right: 20px;
        }

        .menu-item {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .menu-item:hover {
            background: var(--bg-surface-hover);
            color: var(--text-primary);
        }

        .menu-item.active {
            background: var(--bg-surface-hover);
            color: var(--primary);
        }

        /* Tab System */
        .tabs-container {
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border-default);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 5px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--text-primary);
            background: var(--bg-surface-hover);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-close {
            margin-left: 8px;
            opacity: 0.6;
        }

        .tab-close:hover {
            opacity: 1;
        }

        .add-tab-btn {
            padding: 8px 12px;
            background: var(--bg-page);
            border: 1px solid var(--border-default);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            margin-left: 10px;
        }

        .add-tab-btn:hover {
            background: var(--bg-surface-hover);
            color: var(--text-primary);
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            gap: 8px;
            padding: 15px 20px;
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border-default);
            flex-wrap: wrap;
            align-items: center;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            align-items: center;
            padding-right: 12px;
            border-right: 1px solid var(--border-default);
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-btn {
            background: var(--bg-page);
            color: var(--text-secondary);
            border: 1px solid var(--border-default);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            min-width: 40px;
			height: 40px;
        }

        .toolbar-btn:hover {
            background: var(--bg-surface-hover);
            border-color: var(--border-interactive);
            color: var(--text-primary);
        }

        /* Main Container with Sidebar */
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Navigation Sidebar */
        .nav-sidebar {
            width: 250px;
            background: var(--bg-surface);
            border-right: 1px solid var(--border-default);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .nav-sidebar.collapsed {
            width: 0;
            min-width: 0;
            border-right: none;
        }

        .nav-sidebar-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-default);
            background: var(--bg-surface-hover);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-toggle-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .nav-toggle-btn:hover {
            background: var(--bg-surface);
            color: var(--primary);
        }

        .nav-sidebar.collapsed .nav-sidebar-header,
        .nav-sidebar.collapsed .nav-sidebar-content {
            display: none;
        }

        /* Toggle button when sidebar is collapsed */
        .nav-toggle-external {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-left: none;
            border-radius: 0 6px 6px 0;
            padding: 12px 6px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            z-index: 10;
            display: none;
        }

        .main-container:has(.nav-sidebar.collapsed) .nav-toggle-external {
            display: block;
        }

        .nav-toggle-external:hover {
            background: var(--bg-surface-hover);
            color: var(--primary);
        }

        .nav-sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .nav-heading {
            padding: 8px 12px;
            margin: 4px 0;
            background: var(--bg-page);
            border: 1px solid var(--border-default);
            border-radius: 4px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            display: block;
            text-align: left;
            width: 100%;
        }

        .nav-heading:hover {
            background: var(--bg-surface-hover);
            color: var(--text-primary);
            border-color: var(--primary);
        }

        .nav-heading.level-1 { 
            font-weight: 600;
            font-size: 14px;
        }
        .nav-heading.level-2 { 
            padding-left: 20px;
            font-size: 13px;
        }
        .nav-heading.level-3 { 
            padding-left: 30px;
            font-size: 12px;
        }
        .nav-heading.level-4 { 
            padding-left: 40px;
            font-size: 12px;
        }
        .nav-heading.level-5 { 
            padding-left: 50px;
            font-size: 11px;
        }
        .nav-heading.level-6 { 
            padding-left: 60px;
            font-size: 11px;
        }

        .nav-empty {
            padding: 20px;
            text-align: center;
            color: var(--text-tertiary);
            font-size: 12px;
        }

        /* Editor Container */
        .editor-container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            overflow: hidden;
            position: relative;
        }

        .editor-panel, .preview-panel {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            background: var(--bg-surface);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-default);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        #markdownEditor {
            flex: 1;
            background: var(--bg-page);
            border: none;
            padding: var(--margins);
            color: var(--text-primary);
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 14px;
            line-height: var(--spacing-vertical);
            letter-spacing: calc(var(--spacing-horizontal) * 1px);
            word-spacing: calc(var(--word-spacing) * 1px);
            resize: none;
            outline: none;
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            tab-size: 4;
        }

        #markdownPreview {
            flex: 1;
            padding: var(--margins);
            background: var(--bg-page);
            overflow-y: auto;
            overflow-x: auto;
            line-height: var(--spacing-vertical);
            letter-spacing: calc(var(--spacing-horizontal) * 1px);
            word-spacing: calc(var(--word-spacing) * 1px);
            text-align: var(--text-align);
            font-family: var(--font-family);
        }

        /* Preview Styles */
        #markdownPreview h1,
        #markdownPreview h2,
        #markdownPreview h3,
        #markdownPreview h4,
        #markdownPreview h5,
        #markdownPreview h6 {
            margin: 20px 0 10px 0;
            border-bottom: 1px solid var(--border-default);
            padding: 8px 12px;
            border-radius: 4px;
        }

        #markdownPreview h1 {
            font-size: var(--h1-size);
            color: var(--h1-color);
            background: var(--h1-bg);
        }
        #markdownPreview h2 {
            font-size: var(--h2-size);
            color: var(--h2-color);
            background: var(--h2-bg);
        }
        #markdownPreview h3 {
            font-size: var(--h3-size);
            color: var(--h3-color);
            background: var(--h3-bg);
        }
        #markdownPreview h4 {
            font-size: var(--h4-size);
            color: var(--h4-color);
            background: var(--h4-bg);
        }
        #markdownPreview h5 {
            font-size: var(--h5-size);
            color: var(--h5-color);
            background: var(--h5-bg);
        }
        #markdownPreview h6 {
            font-size: var(--h6-size);
            color: var(--h6-color);
            background: var(--h6-bg);
        }

        #markdownPreview p {
            margin: 10px 0;
            font-size: var(--p-size);
        }

        #markdownPreview code {
            background: var(--code-inline-bg);
            color: var(--code-inline-color);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
        }

        #markdownPreview pre {
            background: var(--code-block-bg);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 6px solid var(--code-block-border);
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-word;
        }

        #markdownPreview pre code {
            background: none;
            padding: 0;
            color: inherit;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        #markdownPreview blockquote {
            border-left: 6px solid var(--quote-border);
            padding: 10px 15px;
            margin: 15px 0;
            color: var(--quote-color);
            background: var(--quote-bg);
            border-radius: 0 6px 6px 0;
            font-size: var(--quote-size);
        }

        /* LaTeX Block Styling - Estilo Moderno */
        .latex-block-wrapper {
            position: relative;
            background: var(--latex-block-bg);
            border-left: 6px solid var(--latex-block-border);
            border-top: 2px solid var(--latex-block-border);
            border-bottom: 2px solid var(--latex-block-border);
            border-radius: 0 8px 8px 0;
            padding: 20px 20px 15px 20px;
            margin: 20px 0;
            overflow: hiden; !important
        }
        
        /* LaTeX blocks dentro de tabelas - estilo compacto */
        #markdownPreview td .latex-block-wrapper,
        #markdownPreview th .latex-block-wrapper {
            padding: 10px;
            margin: 5px 0;
            border-left-width: 4px;
            border-radius: 0 4px 4px 0;
            overflow: hidden !important;
            text-align: center;
			max-height: none !important;
        }
        
        #markdownPreview td .latex-block-label,
        #markdownPreview th .latex-block-label {
            font-size: 10px;
            padding: 2px 6px;
            top: 4px;
            right: 6px;
        }

        .latex-block-label {
            position: absolute;
            top: 8px;
            right: 12px;
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .latex-block-wrapper .MathJax,
        .latex-block-wrapper mjx-container {
            color: var(--latex-block-color) !important;
        }

        /* LaTeX Inline Styling */
        #markdownPreview .MathJax {
            color: var(--latex-inline-color) !important;
            background: var(--latex-inline-bg) !important;
            padding: 2px 4px !important;
            border-radius: 3px !important;
        }

        #markdownPreview table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            table-layout: fixed;
        }

        #markdownPreview th,
        #markdownPreview td {
            padding: 12px;
            border: 1px solid var(--border-default);
            text-align: left;
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
            max-width: 300px;
            overflow: hidden; !important;
            vertical-align: top;
        }
        
        /* Garantir que conteúdo dentro de células respeite os limites */
        #markdownPreview td > *,
        #markdownPreview th > * {
            max-width: 100%;
            overflow-wrap: break-word;
        }
        
        /* Blocos LaTeX dentro de tabelas */
        #markdownPreview td mjx-container,
        #markdownPreview th mjx-container {
            max-width: 100% !important;
			transform-origin: center !important;
        }
        
        /* Código dentro de tabelas deve quebrar */
        #markdownPreview td pre,
        #markdownPreview th pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: hidden;
            max-width: 100%;
        }
        
        #markdownPreview td code,
        #markdownPreview th code {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        #markdownPreview th {
            background: var(--table-header-bg);
            color: white;
            font-weight: 600;
        }

        #markdownPreview ul,
        #markdownPreview ol {
            margin: 10px 0 10px 20px;
        }

        #markdownPreview li {
            margin: 5px 0;
        }

        /* Custom HR Style */
        #markdownPreview hr {
            border: none;
            height: var(--hr-thickness);
            background: linear-gradient(
                to right,
                transparent 0%,
                transparent 40%,
                var(--hr-color) 45%,
                var(--hr-color) 55%,
                transparent 60%,
                transparent 100%
            );
            margin: 30px 0;
            position: relative;
        }

        #markdownPreview hr::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(
                to right,
                var(--hr-color) 0%,
                transparent 40%
            );
            opacity: 0.3;
        }

        #markdownPreview hr::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(
                to left,
                var(--hr-color) 0%,
                transparent 40%
            );
            opacity: 0.3;
        }

        /* Settings Panel */
        .settings-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .settings-overlay.active {
            display: flex;
        }

        .settings-panel {
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-default);
        }

        .settings-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--primary-hover));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .close-settings {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 24px;
            padding: 8px;
        }

        .close-settings:hover {
            color: var(--text-primary);
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-default);
        }

        .setting-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }

        .setting-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .setting-input {
            background: var(--bg-page);
            border: 1px solid var(--border-default);
            padding: 8px 12px;
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .color-input {
            width: 80px;
            height: 40px;
            border: 1px solid var(--border-default);
            border-radius: 6px;
            cursor: pointer;
        }

        .theme-buttons {
            display: flex;
            gap: 10px;
        }

        .theme-btn {
            padding: 10px 20px;
            background: var(--bg-page);
            border: 1px solid var(--border-default);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            background: var(--bg-surface-hover);
            color: var(--text-primary);
        }

        .theme-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Status Bar */
        .status-bar {
            background: var(--bg-surface);
            padding: 12px 20px;
            border-top: 1px solid var(--border-default);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-info {
            display: flex;
            gap: 20px;
        }

        /* Print Styles */
        @media print {
            @page {
                size: A4;
                margin: 2cm;
            }

            body {
                background: white !important;
                color: black !important;
            }

            * {
                background: white !important;
                color: black !important;
            }

            .top-menu,
            .tabs-container,
            .toolbar,
            .status-bar,
            .editor-panel,
            .nav-sidebar,
            .settings-overlay {
                display: none !important;
            }

            .main-container {
                display: block;
            }

            .editor-container {
                display: block;
            }

            .preview-panel {
                width: 100%;
                overflow: visible;
            }

            #markdownPreview {
                overflow: visible;
                padding: 0;
            }

            .latex-block-wrapper {
                background: #f5f5f5 !important;
                page-break-inside: avoid;
                border: 1px solid #ccc !important;
            }

            .latex-block-label {
                color: #9C27B0 !important;
            }

            #markdownPreview {
                background: white !important;
            }

            .preview-panel {
                background: white !important;
            }

            #markdownPreview h1,
            #markdownPreview h2,
            #markdownPreview h3,
            #markdownPreview h4,
            #markdownPreview h5,
            #markdownPreview h6 {
                page-break-after: avoid;
                break-after: avoid;
            }

            #markdownPreview pre,
            #markdownPreview blockquote,
            #markdownPreview table {
                page-break-inside: avoid;
                break-inside: avoid;
            }
        }
		
		.menu-item.disabled {
			pointer-events: none;
			opacity: 0.5;
			cursor: not-allowed;
			background: var(--bg-page) !important;
			color: var(--text-tertiary) !important;
		}

		.menu-item.disabled:hover {
			background: var(--bg-page) !important;
			color: var(--text-tertiary) !important;
		}

        /* Light Theme */
        body.light-theme {
            --bg-page: #FFFFFF;
            --bg-surface: #F5F5F5;
            --bg-surface-hover: #E5E5E5;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --border-default: #D1D5DB;
            --border-interactive: #9CA3AF;
            --latex-block-bg: #e3f2fd;
            --latex-block-color: #1a1a2e;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-surface);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-interactive);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        @media (max-width: 968px) {
            .nav-sidebar {
                display: none;
            }
            
            .editor-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Top Menu -->
    <div class="top-menu">
        <div class="menu-title">Editor Markdown</div>
        <div class="menu-item" onclick="newDocument()">
            <i class="fas fa-file"></i> Novo
        </div>
        <div class="menu-item" onclick="loadMarkdownFile()">
            <i class="fas fa-folder-open"></i> Abrir
        </div>
        <div class="menu-item" onclick="saveMarkdown()">
            <i class="fas fa-save"></i> Salvar
        </div>
        <div class="menu-item disabled" onclick="printDocument()">
            <i class="fas fa-print"></i> Imprimir
        </div>
        <div class="menu-item" onclick="openSettings()">
            <i class="fas fa-cog"></i> Configurações
        </div>
        <div class="menu-item" onclick="exportDocument()">
            <i class="fas fa-download"></i> Exportar
        </div>
        <div class="menu-item" id="toGoBackBtn">
            <i class="fas fa-chevron-left"></i> Voltar
        </div>
    </div>

    <!-- Tabs Container -->
    <div class="tabs-container" id="tabsContainer">
        <button class="tab active" data-tab-id="0">
            <i class="fas fa-file-alt"></i>
            <span class="tab-name">Documento 1</span>
            <i class="fas fa-times tab-close" onclick="closeTab(0, event)"></i>
        </button>
        <button class="add-tab-btn" onclick="addNewTab()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
        <div class="toolbar-group">
            <button class="toolbar-btn" onclick="insertText('**', '**')" title="Negrito"><img alt="Negrito" src="./icons/format_bold.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('*', '*')" title="Itálico"><img alt="Itálico" src="./icons/format_italic.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('~~', '~~')" title="Tachado"><img alt="Tachado" src="./icons/format_strikethrough.svg"/></button>
        </div>

        <div class="toolbar-group">
            <button class="toolbar-btn" onclick="insertText('# ', '')" title="Título 1"><img alt="Título 1" src="./icons/format_h1.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('## ', '')" title="Título 2"><img alt="Título 2" src="./icons/format_h2.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('### ', '')" title="Título 3"><img alt="Título 3" src="./icons/format_h3.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('#### ', '')" title="Título 4"><img alt="Título 4" src="./icons/format_h4.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('##### ', '')" title="Título 5"><img alt="Título 5" src="./icons/format_h5.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('###### ', '')" title="Título 6"><img alt="Título 6" src="./icons/format_h6.svg"/></button>
        </div>

        <div class="toolbar-group">
            <button class="toolbar-btn" onclick="insertText('`', '`')" title="Código Inline"><img alt="Código Inline" src="./icons/code.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('```\n', '\n```')" title="Bloco de Código"><img alt="Bloco de Código" src="./icons/code_blocks.svg"/></button>
        </div>

        <div class="toolbar-group">
            <button class="toolbar-btn" onclick="insertText('- ', '')" title="Lista não ordenada"><img alt="Lista com Marcadores" src="./icons/format_list_bulleted.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('1. ', '')" title="Lista numerada"><img alt="Lista Numerada" src="./icons/format_list_numbered.svg"/></button>
            <button class="toolbar-btn" onclick="insertDefinitionList()" title="Lista de definição"><img alt="Lista de Definição" src="./icons/lists.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('> ', '')" title="Citação"><img alt="Citação" src="./icons/format_quote.svg"/></button>
        </div>

        <div class="toolbar-group">
            <button class="toolbar-btn" onclick="insertText('$', '$')" title="LaTeX Inline"><img alt="LaTeX inline" src="./icons/function.svg"/></button>
            <button class="toolbar-btn" onclick="insertText('$$\n', '\n$$')" title="Bloco de LaTeX"><img alt="Bloco de LaTeX" src="./icons/functions.svg"/></button>
        </div>

        <div class="toolbar-group">
            <button class="toolbar-btn" onclick="insertTable()" title="Tabela"><img alt="Tabela" src="./icons/table.svg"/></button>
            <button class="toolbar-btn" onclick="insertLink()" title="Link"><img alt="Link" src="./icons/link.svg"/></button>
            <button class="toolbar-btn" onclick="insertImage()" title="Imagem"><img alt="Imagem" src="./icons/image.svg"/></button>
        </div>

        <div class="toolbar-group">
            <button class="toolbar-btn" onclick="insertText('---\n', '')" title="Linha Horizontal"><img alt="Linha Horizontal" src="./icons/horizontal_rule.svg"/></button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Navigation Sidebar -->
        <div class="nav-sidebar">
            <div class="nav-sidebar-header">
                <div class="nav-sidebar-title">
                    <i class="fas fa-list"></i>
                    Navegação do Documento
                </div>
                <button class="nav-toggle-btn" onclick="toggleNavSidebar()" title="Esconder navegação">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <div class="nav-sidebar-content" id="navSidebarContent">
                <div class="nav-empty">Nenhum título encontrado</div>
            </div>
        </div>

        <!-- Editor Container -->
        <div class="editor-container">
            <button class="nav-toggle-external" onclick="toggleNavSidebar()" title="Mostrar navegação">
                <i class="fas fa-chevron-right"></i>
            </button>
            <div class="editor-panel">
                <div class="panel-header">
                    <span class="panel-title">
                        <i class="fas fa-edit"></i> EDITOR MARKDOWN
                    </span>
                </div>
                <textarea id="markdownEditor" placeholder="Digite seu conteúdo Markdown aqui...

# Exemplo de Título
**Texto em negrito** e *itálico*

## Código
```python
def hello_world():
    return 'Hello, World!'
```

## Matemática com LaTeX
Equação de Schrödinger:
$$
i\hbar\frac{\partial}{\partial t}\Psi = \hat{H}\Psi
$$

Einstein inline: $E = mc^2$

Integral definida:
$$
\int_{a}^{b} f(x) dx
$$

## Citação
> Esta é uma citação com estilo personalizado

## Tabela
| Coluna 1 | Coluna 2 | Coluna 3 |
|----------|----------|----------|
| Dado 1   | Dado 2   | Dado 3   |

---"></textarea>
            </div>

            <div class="preview-panel">
                <div class="panel-header">
                    <span class="panel-title">
                        <i class="fas fa-eye"></i> PREVIEW EM TEMPO REAL
                    </span>
                </div>
                <div id="markdownPreview"></div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-info">
            <span id="charCount">0 caracteres</span>
            <span id="wordCount">0 palavras</span>
            <span id="lineCount">1 linha</span>
        </div>
        <div class="status-actions">
            <span>Editor Markdown Avançado • Modo: Markdown + LaTeX</span>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-overlay" id="settingsOverlay">
        <div class="settings-panel">
            <div class="settings-header">
                <h2 class="settings-title">Configurações</h2>
                <button class="close-settings" onclick="closeSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Theme Settings -->
            <div class="settings-section">
                <h3 class="section-title">Tema Geral</h3>
                <div class="setting-row">
                    <div class="setting-label">Tema do Editor</div>
                    <div class="theme-buttons">
                        <button class="theme-btn active" onclick="setTheme('dark')">Dark</button>
                        <button class="theme-btn" onclick="setTheme('light')">Light</button>
                    </div>
                </div>
            </div>

            <!-- Heading Colors -->
            <div class="settings-section">
                <h3 class="section-title">Cores dos Títulos</h3>
                <div class="setting-row">
                    <div class="setting-label">H1 - Cor do Texto</div>
                    <input type="color" class="color-input" id="h1Color" value="#019875">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H1 - Cor de Fundo</div>
                    <input type="color" class="color-input" id="h1Bg" value="#000000">
                    <input type="checkbox" id="h1BgTransparent" checked> Transparente
                </div>
                <div class="setting-row">
                    <div class="setting-label">H2 - Cor do Texto</div>
                    <input type="color" class="color-input" id="h2Color" value="#019875">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H2 - Cor de Fundo</div>
                    <input type="color" class="color-input" id="h2Bg" value="#000000">
                    <input type="checkbox" id="h2BgTransparent" checked> Transparente
                </div>
                <div class="setting-row">
                    <div class="setting-label">H3 - Cor do Texto</div>
                    <input type="color" class="color-input" id="h3Color" value="#019875">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H3 - Cor de Fundo</div>
                    <input type="color" class="color-input" id="h3Bg" value="#000000">
                    <input type="checkbox" id="h3BgTransparent" checked> Transparente
                </div>
                <div class="setting-row">
                    <div class="setting-label">H4 - Cor do Texto</div>
                    <input type="color" class="color-input" id="h4Color" value="#019875">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H4 - Cor de Fundo</div>
                    <input type="color" class="color-input" id="h4Bg" value="#000000">
                    <input type="checkbox" id="h4BgTransparent" checked> Transparente
                </div>
                <div class="setting-row">
                    <div class="setting-label">H5 - Cor do Texto</div>
                    <input type="color" class="color-input" id="h5Color" value="#019875">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H5 - Cor de Fundo</div>
                    <input type="color" class="color-input" id="h5Bg" value="#000000">
                    <input type="checkbox" id="h5BgTransparent" checked> Transparente
                </div>
                <div class="setting-row">
                    <div class="setting-label">H6 - Cor do Texto</div>
                    <input type="color" class="color-input" id="h6Color" value="#A1A1AA">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H6 - Cor de Fundo</div>
                    <input type="color" class="color-input" id="h6Bg" value="#000000">
                    <input type="checkbox" id="h6BgTransparent" checked> Transparente
                </div>
            </div>

            <!-- Code Inline -->
            <div class="settings-section">
                <h3 class="section-title">Código Inline</h3>
                <div class="setting-row">
                    <div class="setting-label">Cor do Texto</div>
                    <input type="color" class="color-input" id="codeInlineColor" value="#3B82F6">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Cor de Fundo</div>
                    <input type="color" class="color-input" id="codeInlineBg" value="#0D0D0D">
                </div>
            </div>

            <!-- LaTeX Inline -->
            <div class="settings-section">
                <h3 class="section-title">LaTeX Inline</h3>
                <div class="setting-row">
                    <div class="setting-label">Cor do Texto</div>
                    <input type="color" class="color-input" id="latexInlineColor" value="#E4E4E7">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Cor de Fundo</div>
                    <input type="color" class="color-input" id="latexInlineBg" value="#000000">
                    <input type="checkbox" id="latexInlineBgTransparent" checked> Transparente
                </div>
            </div>

            <!-- Quote Block -->
            <div class="settings-section">
                <h3 class="section-title">Bloco de Citação</h3>
                <div class="setting-row">
                    <div class="setting-label">Cor do Texto</div>
                    <input type="color" class="color-input" id="quoteColor" value="#A1A1AA">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Cor de Fundo</div>
                    <input type="color" class="color-input" id="quoteBg" value="#0A2720">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Cor da Borda</div>
                    <input type="color" class="color-input" id="quoteBorder" value="#019875">
                </div>
            </div>

            <!-- LaTeX Block -->
            <div class="settings-section">
                <h3 class="section-title">Bloco de LaTeX</h3>
                <div class="setting-row">
                    <div class="setting-label">Cor do Texto</div>
                    <input type="color" class="color-input" id="latexBlockColor" value="#1a1a2e">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Cor de Fundo (Azul Claro)</div>
                    <input type="color" class="color-input" id="latexBlockBg" value="#e3f2fd">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Cor da Borda</div>
                    <input type="color" class="color-input" id="latexBlockBorder" value="#2196F3">
                </div>
            </div>

            <!-- Code Block -->
            <div class="settings-section">
                <h3 class="section-title">Bloco de Código</h3>
                <div class="setting-row">
                    <div class="setting-label">Cor de Fundo</div>
                    <input type="color" class="color-input" id="codeBlockBg" value="#141414">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Cor da Borda</div>
                    <input type="color" class="color-input" id="codeBlockBorder" value="#019875">
                </div>
            </div>

            <!-- Table Header -->
            <div class="settings-section">
                <h3 class="section-title">Cabeçalho da Tabela</h3>
                <div class="setting-row">
                    <div class="setting-label">Cor de Fundo</div>
                    <input type="color" class="color-input" id="tableHeaderBg" value="#019875">
                </div>
            </div>

            <!-- HR Customization -->
            <div class="settings-section">
                <h3 class="section-title">Linha Horizontal (HR)</h3>
                <div class="setting-row">
                    <div class="setting-label">Cor</div>
                    <input type="color" class="color-input" id="hrColor" value="#00ff88">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Espessura (px)</div>
                    <input type="number" class="setting-input" id="hrThickness" value="2" min="1" max="10">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Estilo</div>
                    <select class="setting-input" id="hrStyle">
                        <option value="solid">Sólida</option>
                        <option value="dashed">Tracejada</option>
                        <option value="dotted">Pontilhada</option>
                    </select>
                </div>
            </div>

            <!-- Spacing -->
            <div class="settings-section">
                <h3 class="section-title">Espaçamento</h3>
                <div class="setting-row">
                    <div class="setting-label">Horizontal (caracteres)</div>
                    <input type="number" class="setting-input" id="spacingHorizontal" value="0" min="-5" max="10" step="0.1">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Vertical (linhas)</div>
                    <input type="number" class="setting-input" id="spacingVertical" value="1.7" min="1" max="3" step="0.1">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Entre Palavras</div>
                    <input type="number" class="setting-input" id="wordSpacing" value="0" min="-5" max="20" step="1">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Margens (px)</div>
                    <input type="number" class="setting-input" id="margins" value="20" min="0" max="100" step="5">
                </div>
            </div>

            <!-- Alignment -->
            <div class="settings-section">
                <h3 class="section-title">Alinhamento</h3>
                <div class="setting-row">
                    <div class="setting-label">Alinhamento do Texto</div>
                    <select class="setting-input" id="textAlign">
                        <option value="left">Esquerda</option>
                        <option value="right">Direita</option>
                        <option value="center">Centro</option>
                        <option value="justify">Justificado</option>
                    </select>
                </div>
            </div>

            <!-- Font Family -->
            <div class="settings-section">
                <h3 class="section-title">Fonte</h3>
                <div class="setting-row">
                    <div class="setting-label">Família da Fonte</div>
                    <select class="setting-input" id="fontFamily">
                        <option value="'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif">Segoe UI</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="'Times New Roman', serif">Times New Roman</option>
                        <option value="'Courier New', monospace">Courier New</option>
                        <option value="Calibri, sans-serif">Calibri</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value="Verdana, sans-serif">Verdana</option>
                        <option value="'Monotype Corsiva', cursive">Monotype Corsiva</option>
                        <option value="'Cambria Math', serif">Cambria Math</option>
                    </select>
                </div>
            </div>

            <!-- Font Sizes -->
            <div class="settings-section">
                <h3 class="section-title">Tamanho das Fontes</h3>
                <div class="setting-row">
                    <div class="setting-label">H1</div>
                    <input type="text" class="setting-input" id="h1Size" value="2em">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H2</div>
                    <input type="text" class="setting-input" id="h2Size" value="1.6em">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H3</div>
                    <input type="text" class="setting-input" id="h3Size" value="1.3em">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H4</div>
                    <input type="text" class="setting-input" id="h4Size" value="1.1em">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H5</div>
                    <input type="text" class="setting-input" id="h5Size" value="1em">
                </div>
                <div class="setting-row">
                    <div class="setting-label">H6</div>
                    <input type="text" class="setting-input" id="h6Size" value="0.9em">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Parágrafo</div>
                    <input type="text" class="setting-input" id="pSize" value="16px">
                </div>
                <div class="setting-row">
                    <div class="setting-label">Citação</div>
                    <input type="text" class="setting-input" id="quoteSize" value="16px">
                </div>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
                <button class="theme-btn" onclick="resetSettings()">Restaurar Padrão</button>
                <button class="theme-btn active" onclick="applySettings()">Aplicar Configurações</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        const editor = document.getElementById('markdownEditor');
        const preview = document.getElementById('markdownPreview');
        const charCount = document.getElementById('charCount');
        const wordCount = document.getElementById('wordCount');
        const lineCount = document.getElementById('lineCount');
        const navSidebarContent = document.getElementById('navSidebarContent');
        const settingsOverlay = document.getElementById('settingsOverlay');

        // Tab management
        let tabs = [
            { id: 0, name: 'Documento 1', content: editor.value }
        ];
        let currentTabId = 0;
        let nextTabId = 1;

        // Initialize
        window.onload = () => {
            loadSettings();
            updatePreview();
            updateStats();
            updateNavigation();
        };

        // Tab Functions
        function addNewTab() {
            const newTab = {
                id: nextTabId,
                name: `Documento ${nextTabId + 1}`,
                content: ''
            };
            tabs.push(newTab);
            renderTabs();
            switchTab(nextTabId);
            nextTabId++;
        }

        function closeTab(tabId, event) {
            event.stopPropagation();
            if (tabs.length === 1) {
                alert('Você deve manter pelo menos uma aba aberta!');
                return;
            }
            const index = tabs.findIndex(t => t.id === tabId);
            if (index !== -1) {
                tabs.splice(index, 1);
                if (currentTabId === tabId) {
                    switchTab(tabs[0].id);
                }
                renderTabs();
            }
        }

        function switchTab(tabId) {
            // Save current tab content
            const currentTab = tabs.find(t => t.id === currentTabId);
            if (currentTab) {
                currentTab.content = editor.value;
            }

            // Switch to new tab
            currentTabId = tabId;
            const newTab = tabs.find(t => t.id === tabId);
            if (newTab) {
                editor.value = newTab.content;
                updatePreview();
                updateStats();
                updateNavigation();
            }

            renderTabs();
        }

        function renderTabs() {
            const container = document.getElementById('tabsContainer');
            container.innerHTML = '';

            tabs.forEach(tab => {
                const tabBtn = document.createElement('button');
                tabBtn.className = 'tab' + (tab.id === currentTabId ? ' active' : '');
                tabBtn.innerHTML = `
                    <i class="fas fa-file-alt"></i>
                    <span class="tab-name">${tab.name}</span>
                    <i class="fas fa-times tab-close"></i>
                `;
                tabBtn.querySelector('.tab-close').onclick = (e) => closeTab(tab.id, e);
                tabBtn.onclick = () => switchTab(tab.id);
                container.appendChild(tabBtn);
            });

            const addBtn = document.createElement('button');
            addBtn.className = 'add-tab-btn';
            addBtn.innerHTML = '<i class="fas fa-plus"></i>';
            addBtn.onclick = addNewTab;
            container.appendChild(addBtn);
        }

        // Wrap LaTeX blocks with custom styling
        function wrapLatexBlocks() {
            const mathBlocks = preview.querySelectorAll('mjx-container[display="true"]');
            
            mathBlocks.forEach(block => {
                // Check if already wrapped
                if (block.parentElement.classList.contains('latex-block-wrapper')) {
                    return;
                }
                
                // Create wrapper
                const wrapper = document.createElement('div');
                wrapper.className = 'latex-block-wrapper';
                
                // Create label
                const label = document.createElement('div');
                label.className = 'latex-block-label';
                label.textContent = 'LATEX';
                
                // Wrap the block
                block.parentNode.insertBefore(wrapper, block);
                wrapper.appendChild(block);
                wrapper.appendChild(label);
            });
        }
		
		// Update preview and stats
        function updatePreview() {
            let markdownText = editor.value;
            
            // Salvar posição do scroll antes de atualizar
            const scrollPos = preview.scrollTop;
            const scrollPercentage = preview.scrollHeight > 0 ? scrollPos / preview.scrollHeight : 0;
            
            // Processar linha por linha para proteger pipes em código inline apenas em linhas de tabela
            const lines = markdownText.split('\n');
            const processedLines = lines.map(line => {
                // Detectar se é uma linha de tabela (contém | fora de backticks)
                // Contar pipes fora de código
                let inCode = false;
                let pipeCount = 0;
                
                for (let i = 0; i < line.length; i++) {
                    if (line[i] === '`') {
                        inCode = !inCode;
                    } else if (line[i] === '|' && !inCode) {
                        pipeCount++;
                    }
                }
                
                // Se tem pelo menos 1 pipe fora de código, é provável que seja tabela
                if (pipeCount > 0) {
                    // Proteger pipes dentro de código usando barra invertida
                    let result = '';
                    let inBacktick = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        if (line[i] === '`') {
                            inBacktick = !inBacktick;
                            result += line[i];
                        } else if (line[i] === '|' && inBacktick) {
                            // Usar barra invertida para escapar pipe dentro de código
                            result += '\\|';
                        } else {
                            result += line[i];
                        }
                    }
                    
                    return result;
                }
                
                return line;
            });
            
            markdownText = processedLines.join('\n');
            
            // Configurar marked.js
            marked.setOptions({
                breaks: true,
                gfm: true
            });
            
            // Parse do markdown
            let html = marked.parse(markdownText);
            
            preview.innerHTML = html;
            
            updateStats();
            updateNavigation();

            if (window.MathJax) {
                setTimeout(() => {
                    MathJax.typesetPromise([preview]).then(() => {
                        wrapLatexBlocks();
                        // Restaurar posição do scroll após renderização
                        preview.scrollTop = preview.scrollHeight * scrollPercentage;
                    }).catch((err) => console.error(err.message));
                }, 0);
            } else {
                // Restaurar posição do scroll se não houver MathJax
                setTimeout(() => {
                    preview.scrollTop = preview.scrollHeight * scrollPercentage;
                }, 50);
            }

            preview.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        }
		
        function updateStats() {
            const text = editor.value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            const lines = text.split('\n').length;
            
            charCount.textContent = `${text.length} caracteres`;
            wordCount.textContent = `${words} palavras`;
            lineCount.textContent = `${lines} linhas`;
        }

        function updateNavigation() {
            const headings = preview.querySelectorAll('h1, h2, h3, h4, h5, h6');
            navSidebarContent.innerHTML = '';

            if (headings.length === 0) {
                navSidebarContent.innerHTML = '<div class="nav-empty">Nenhum título encontrado</div>';
                return;
            }

            headings.forEach((heading, index) => {
                const level = heading.tagName.toLowerCase();
                const text = heading.textContent;
                const navItem = document.createElement('button');
                navItem.className = `nav-heading level-${level.charAt(1)}`;
                navItem.textContent = text;
                navItem.onclick = () => scrollToHeading(heading);
                navSidebarContent.appendChild(navItem);
            });
        }

        function scrollToHeading(heading) {
            // Scroll preview
            heading.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Try to scroll editor to corresponding line
            const headingText = heading.textContent;
            const editorContent = editor.value;
            const lines = editorContent.split('\n');
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes(headingText)) {
                    const lineHeight = parseInt(window.getComputedStyle(editor).lineHeight);
                    editor.scrollTop = i * lineHeight;
                    break;
                }
            }
        }

        editor.addEventListener('input', updatePreview);

        // Toggle Navigation Sidebar
        function toggleNavSidebar() {
            const navSidebar = document.querySelector('.nav-sidebar');
            navSidebar.classList.toggle('collapsed');
        }

        // Tab handling
        function handleTabKey(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                const text = editor.value;
                
                if (start !== end) {
                    const before = text.substring(0, start);
                    const selected = text.substring(start, end);
                    const after = text.substring(end);
                    
                    if (e.shiftKey) {
                        const dedented = selected.replace(/^( {2}|\t)/gm, '');
                        editor.value = before + dedented + after;
                        editor.setSelectionRange(start, start + dedented.length);
                    } else {
                        const indented = selected.replace(/^/gm, '  ');
                        editor.value = before + indented + after;
                        editor.setSelectionRange(start, start + indented.length);
                    }
                } else {
                    const spaces = '  ';
                    editor.value = text.substring(0, start) + spaces + text.substring(end);
                    editor.setSelectionRange(start + spaces.length, start + spaces.length);
                }
                
                updatePreview();
            }
        }

        editor.addEventListener('keydown', handleTabKey);

        // Text insertion functions
        function insertText(prefix, suffix) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;

            const before = text.substring(0, start);
            const selected = text.substring(start, end);
            const after = text.substring(end);

            let newText;
            if (selected.length > 0) {
                newText = before + prefix + selected + suffix + after;
            } else {
                newText = before + prefix + suffix + after;
            }

            editor.value = newText;
            const cursorPos = selected.length > 0 ? end + prefix.length + suffix.length : start + prefix.length;
            editor.setSelectionRange(cursorPos, cursorPos);
            editor.focus();
            updatePreview();
        }
        
        function insertTable() {
            const tableTemplate = `| Coluna 1 | Coluna 2 | Coluna 3 |
|----------|----------|----------|
| Célula 1 | Célula 2 | Célula 3 |
| Célula 4 | Célula 5 | Célula 6 |

`;
            insertText(tableTemplate, '');
        }
        
        function insertLink() {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;
            const selected = text.substring(start, end);
            
            if (selected.length > 0) {
                insertText('[', '](url)');
            } else {
                insertText('[texto do link](', ')');
            }
        }
        
        function insertImage() {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;
            const selected = text.substring(start, end);
            
            if (selected.length > 0) {
                insertText('![', '](url-da-imagem)');
            } else {
                insertText('![texto alternativo](', ')');
            }
        }
        
        function insertDefinitionList() {
            const defListTemplate = `Termo 1\n: Definição do termo 1\n\nTermo 2\n: Definição do termo 2\n\n`;
            insertText(defListTemplate, '');
        }

        function newDocument() {
            addNewTab();
        }

        function saveMarkdown() {
            const currentTab = tabs.find(t => t.id === currentTabId);
            const text = editor.value;
            const blob = new Blob([text], {type: 'text/markdown'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentTab.name}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function loadMarkdownFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.md,.markdown,.txt';
            
            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    editor.value = e.target.result;
                    updatePreview();
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function printDocument() {
            window.print();
        }

        function exportDocument() {
            saveMarkdown();
        }

        // Settings Functions
        function openSettings() {
            settingsOverlay.classList.add('active');
        }

        function closeSettings() {
            settingsOverlay.classList.remove('active');
        }

        function setTheme(theme) {
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (theme === 'light') {
                document.body.classList.add('light-theme');
            } else {
                document.body.classList.remove('light-theme');
            }
            
            saveSettings();
        }

        function applySettings() {
            const root = document.documentElement;

            // Heading colors
            for (let i = 1; i <= 6; i++) {
                root.style.setProperty(`--h${i}-color`, document.getElementById(`h${i}Color`).value);
                const bgTransparent = document.getElementById(`h${i}BgTransparent`).checked;
                root.style.setProperty(`--h${i}-bg`, bgTransparent ? 'transparent' : document.getElementById(`h${i}Bg`).value);
            }

            // Code inline
            root.style.setProperty('--code-inline-color', document.getElementById('codeInlineColor').value);
            root.style.setProperty('--code-inline-bg', document.getElementById('codeInlineBg').value);

            // LaTeX inline
            root.style.setProperty('--latex-inline-color', document.getElementById('latexInlineColor').value);
            const latexInlineBgTransparent = document.getElementById('latexInlineBgTransparent').checked;
            root.style.setProperty('--latex-inline-bg', latexInlineBgTransparent ? 'transparent' : document.getElementById('latexInlineBg').value);

            // Quote
            root.style.setProperty('--quote-color', document.getElementById('quoteColor').value);
            root.style.setProperty('--quote-bg', document.getElementById('quoteBg').value);
            root.style.setProperty('--quote-border', document.getElementById('quoteBorder').value);

            // LaTeX block
            root.style.setProperty('--latex-block-color', document.getElementById('latexBlockColor').value);
            root.style.setProperty('--latex-block-bg', document.getElementById('latexBlockBg').value);
            root.style.setProperty('--latex-block-border', document.getElementById('latexBlockBorder').value);

            // Code block
            root.style.setProperty('--code-block-bg', document.getElementById('codeBlockBg').value);
            root.style.setProperty('--code-block-border', document.getElementById('codeBlockBorder').value);

            // Table header
            root.style.setProperty('--table-header-bg', document.getElementById('tableHeaderBg').value);

            // HR
            root.style.setProperty('--hr-color', document.getElementById('hrColor').value);
            root.style.setProperty('--hr-thickness', document.getElementById('hrThickness').value + 'px');
            root.style.setProperty('--hr-style', document.getElementById('hrStyle').value);

            // Spacing
            root.style.setProperty('--spacing-horizontal', document.getElementById('spacingHorizontal').value);
            root.style.setProperty('--spacing-vertical', document.getElementById('spacingVertical').value);
            root.style.setProperty('--word-spacing', document.getElementById('wordSpacing').value);
            root.style.setProperty('--margins', document.getElementById('margins').value + 'px');

            // Alignment
            root.style.setProperty('--text-align', document.getElementById('textAlign').value);

            // Font
            root.style.setProperty('--font-family', document.getElementById('fontFamily').value);

            // Font sizes
            root.style.setProperty('--h1-size', document.getElementById('h1Size').value);
            root.style.setProperty('--h2-size', document.getElementById('h2Size').value);
            root.style.setProperty('--h3-size', document.getElementById('h3Size').value);
            root.style.setProperty('--h4-size', document.getElementById('h4Size').value);
            root.style.setProperty('--h5-size', document.getElementById('h5Size').value);
            root.style.setProperty('--h6-size', document.getElementById('h6Size').value);
            root.style.setProperty('--p-size', document.getElementById('pSize').value);
            root.style.setProperty('--quote-size', document.getElementById('quoteSize').value);

            saveSettings();
            closeSettings();
            updatePreview();
        }

        function saveSettings() {
            const settings = {
                theme: document.body.classList.contains('light-theme') ? 'light' : 'dark',
                h1Color: document.getElementById('h1Color').value,
                h1Bg: document.getElementById('h1Bg').value,
                h1BgTransparent: document.getElementById('h1BgTransparent').checked,
                h2Color: document.getElementById('h2Color').value,
                h2Bg: document.getElementById('h2Bg').value,
                h2BgTransparent: document.getElementById('h2BgTransparent').checked,
                h3Color: document.getElementById('h3Color').value,
                h3Bg: document.getElementById('h3Bg').value,
                h3BgTransparent: document.getElementById('h3BgTransparent').checked,
                h4Color: document.getElementById('h4Color').value,
                h4Bg: document.getElementById('h4Bg').value,
                h4BgTransparent: document.getElementById('h4BgTransparent').checked,
                h5Color: document.getElementById('h5Color').value,
                h5Bg: document.getElementById('h5Bg').value,
                h5BgTransparent: document.getElementById('h5BgTransparent').checked,
                h6Color: document.getElementById('h6Color').value,
                h6Bg: document.getElementById('h6Bg').value,
                h6BgTransparent: document.getElementById('h6BgTransparent').checked,
                codeInlineColor: document.getElementById('codeInlineColor').value,
                codeInlineBg: document.getElementById('codeInlineBg').value,
                latexInlineColor: document.getElementById('latexInlineColor').value,
                latexInlineBg: document.getElementById('latexInlineBg').value,
                latexInlineBgTransparent: document.getElementById('latexInlineBgTransparent').checked,
                quoteColor: document.getElementById('quoteColor').value,
                quoteBg: document.getElementById('quoteBg').value,
                quoteBorder: document.getElementById('quoteBorder').value,
                latexBlockColor: document.getElementById('latexBlockColor').value,
                latexBlockBg: document.getElementById('latexBlockBg').value,
                latexBlockBorder: document.getElementById('latexBlockBorder').value,
                codeBlockBg: document.getElementById('codeBlockBg').value,
                codeBlockBorder: document.getElementById('codeBlockBorder').value,
                tableHeaderBg: document.getElementById('tableHeaderBg').value,
                hrColor: document.getElementById('hrColor').value,
                hrThickness: document.getElementById('hrThickness').value,
                hrStyle: document.getElementById('hrStyle').value,
                spacingHorizontal: document.getElementById('spacingHorizontal').value,
                spacingVertical: document.getElementById('spacingVertical').value,
                wordSpacing: document.getElementById('wordSpacing').value,
                margins: document.getElementById('margins').value,
                textAlign: document.getElementById('textAlign').value,
                fontFamily: document.getElementById('fontFamily').value,
                h1Size: document.getElementById('h1Size').value,
                h2Size: document.getElementById('h2Size').value,
                h3Size: document.getElementById('h3Size').value,
                h4Size: document.getElementById('h4Size').value,
                h5Size: document.getElementById('h5Size').value,
                h6Size: document.getElementById('h6Size').value,
                pSize: document.getElementById('pSize').value,
                quoteSize: document.getElementById('quoteSize').value
            };

            localStorage.setItem('markdownEditorSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('markdownEditorSettings');
            if (!savedSettings) return;

            const settings = JSON.parse(savedSettings);

            // Apply theme
            if (settings.theme === 'light') {
                document.body.classList.add('light-theme');
                document.querySelectorAll('.theme-btn')[1].classList.add('active');
                document.querySelectorAll('.theme-btn')[0].classList.remove('active');
            }

            // Load all settings
            Object.keys(settings).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = settings[key];
                    } else {
                        element.value = settings[key];
                    }
                }
            });

            applySettings();
        }

        function resetSettings() {
            if (confirm('Tem certeza que deseja restaurar as configurações padrão?')) {
                localStorage.removeItem('markdownEditorSettings');
                location.reload();
            }
        }

		document.getElementById('toGoBackBtn').addEventListener('click', toGoBack);
		
		function toGoBack() {
			const base = window.location.origin;
			window.location.href = "../index.html";
		}

        // Close settings on overlay click
        settingsOverlay.addEventListener('click', (e) => {
            if (e.target === settingsOverlay) {
                closeSettings();
            }
        });
    </script>
</body>
</html>

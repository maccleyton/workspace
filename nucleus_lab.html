<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NUCLEUS LAB ‚Äî Laborat√≥rio de F√≠sica Nuclear e de Part√≠culas</title>
  <link href="./css/style.css" rel="stylesheet" type="text/css"/>
  </style>
</head>
<body>
  <header>
    <h1>NUCLEUS LAB</h1>
    <p class="subtitle">Laborat√≥rio de F√≠sica Nuclear e de Part√≠culas</p>
  </header>

  <!-- Abas de navega√ß√£o -->
  <div class="tab-container">
    <div class="tab active" data-tab="nuclear">‚öõÔ∏è F√≠sica Nuclear</div>
    <div class="tab" data-tab="particles">üî¨ F√≠sica de Part√≠culas</div>
  </div>

  <!-- Conte√∫do da F√≠sica Nuclear -->
  <div class="tab-content active" id="nuclear-tab">
    <main>
      <div class="canvas-container">
        <canvas id="atomCanvas" width="480" height="360"></canvas>
      </div>

      <div class="controls-panel">
        <div class="card">
          <div class="card-title">Criar √Åtomo</div>
          <div class="input-group">
            <span class="input-label">Pr√≥tons:</span>
            <input type="number" id="protons" min="1" max="118" value="1">
          </div>
          <div class="input-group">
            <span class="input-label">N√™utrons:</span>
            <input type="number" id="neutrons" min="0" value="0">
          </div>
          <div class="input-group">
            <span class="input-label">El√©trons:</span>
            <input type="number" id="electrons" min="0" value="1">
          </div>
          <div class="button-group">
            <button onclick="createAtom()">Criar</button>
            <button onclick="absorbPhoton()">Absorver F√≥ton</button>
            <button onclick="reset()">Resetar</button>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Fus√£o Nuclear</div>
          <div class="button-group">
            <button onclick="startFusionMode()">Definir √Åtomo 1</button>
            <button onclick="setAtom2()">Definir √Åtomo 2 e Colidir</button>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Decaimento Radioativo</div>
          <div class="button-group">
            <button onclick="simulateAlphaDecay()">Decaimento Alpha</button>
            <button onclick="simulateBetaDecay()">Decaimento Beta</button>
            <button class="warning" onclick="simulateFission()">Fiss√£o Nuclear</button>
          </div>
        </div>
      </div>

      <div class="results-panel">
        <div class="results-title">Resultados Nucleares</div>
        <div id="info"></div>
        <div class="button-group">
          <button class="success" onclick="exportData()">Exportar Dados</button>
        </div>
      </div>
    </main>
  </div>

  <!-- Conte√∫do da F√≠sica de Part√≠culas -->
  <div class="tab-content" id="particles-tab">
    <main>
      <div class="canvas-container">
        <canvas id="particleCanvas" width="480" height="400"></canvas>
        <div class="accelerator-tube">
          <div class="beam-line" id="beamLine"></div>
          <div class="detector" id="detector"></div>
        </div>
      </div>

      <div class="controls-panel">
        <div class="card">
          <div class="card-title">Acelerador de Part√≠culas</div>
          
          <div class="slider-container">
            <div class="slider-label">
              <span>Energia do Feixe</span>
              <span id="energyValue">10 GeV</span>
            </div>
            <input type="range" min="1" max="50" value="10" class="slider" id="energySlider">
          </div>

          <div class="slider-container">
            <div class="slider-label">
              <span>Intensidade</span>
              <span id="intensityValue">50%</span>
            </div>
            <input type="range" min="10" max="100" value="50" class="slider" id="intensitySlider">
          </div>

          <div class="button-group">
            <button onclick="startAccelerator()">Iniciar Acelerador</button>
            <button class="warning" onclick="stopAccelerator()">Parar</button>
            <button onclick="collideParticles()">Colidir Part√≠culas</button>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Tipos de Part√≠culas</div>
          <div class="button-group">
            <button onclick="selectParticle('proton')">Pr√≥ton</button>
            <button onclick="selectParticle('electron')">El√©tron</button>
            <button onclick="selectParticle('alpha')">Part√≠cula Alpha</button>
            <button onclick="selectParticle('photon')">F√≥ton</button>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Detetores</div>
          <div class="button-group">
            <button onclick="toggleMagneticField()">Campo Magn√©tico</button>
            <button onclick="toggleCalorimeter()">Calor√≠metro</button>
            <button onclick="resetDetectors()">Resetar Detetores</button>
          </div>
        </div>
      </div>

      <div class="results-panel">
        <div class="results-title">Resultados das Colis√µes</div>
        <div id="particleInfo"></div>
        <div class="particle-log" id="particleLog">
          <div class="log-entry">Sistema inicializado</div>
        </div>
        <div class="button-group">
          <button class="success" onclick="analyzeEvent()">Analisar Evento</button>
          <button onclick="clearLog()">Limpar Log</button>
        </div>
      </div>
    </main>
  </div>

  <script src="lab2.js"></script>
  <script>
    // ====== SISTEMA DE ABAS ======
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', function() {
        // Remove classe active de todas as abas e conte√∫dos
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Adiciona classe active na aba clicada
        this.classList.add('active');
        
        // Mostra o conte√∫do correspondente
        const tabId = this.getAttribute('data-tab') + '-tab';
        document.getElementById(tabId).classList.add('active');
      });
    });

    // ====== M√ìDULO DE F√çSICA DE PART√çCULAS ======
    const particleCanvas = document.getElementById('particleCanvas');
    const particleCtx = particleCanvas.getContext('2d');
    let acceleratorRunning = false;
    let selectedParticle = 'proton';
    let magneticField = false;
    let calorimeter = false;

    class Particle {
      constructor(type, energy) {
        this.type = type;
        this.energy = energy;
        this.x = 50;
        this.y = particleCanvas.height / 2;
        this.vx = 2 + (energy / 10);
        this.radius = this.getRadius();
        this.color = this.getColor();
        this.trail = [];
        this.maxTrail = 20;
      }

      getRadius() {
        const sizes = {
          'proton': 6,
          'electron': 3,
          'alpha': 8,
          'photon': 4
        };
        return sizes[this.type] || 5;
      }

      getColor() {
        const colors = {
          'proton': '#4fc3f7',
          'electron': '#ff5252',
          'alpha': '#66bb6a',
          'photon': '#ffeb3b'
        };
        return colors[this.type] || '#ffffff';
      }

      update() {
        // Efeito do campo magn√©tico
        if (magneticField) {
          this.y += Math.sin(Date.now() * 0.01) * 0.5;
        }

        this.x += this.vx;
        
        // Adicionar posi√ß√£o ao rastro
        this.trail.push({x: this.x, y: this.y});
        if (this.trail.length > this.maxTrail) {
          this.trail.shift();
        }

        return this.x < particleCanvas.width + 50;
      }

      draw() {
        // Desenhar rastro
        for (let i = 0; i < this.trail.length; i++) {
          const point = this.trail[i];
          const alpha = i / this.trail.length;
          particleCtx.fillStyle = this.color.replace(')', `, ${alpha})`).replace('rgb', 'rgba');
          particleCtx.beginPath();
          particleCtx.arc(point.x, point.y, this.radius * alpha, 0, Math.PI * 2);
          particleCtx.fill();
        }

        // Desenhar part√≠cula
        particleCtx.fillStyle = this.color;
        particleCtx.beginPath();
        particleCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        particleCtx.fill();

        // Efeito de brilho para part√≠culas energ√©ticas
        if (this.energy > 20) {
          particleCtx.strokeStyle = this.color;
          particleCtx.lineWidth = 2;
          particleCtx.beginPath();
          particleCtx.arc(this.x, this.y, this.radius + 3, 0, Math.PI * 2);
          particleCtx.stroke();
        }
      }
    }

    let particles = [];
    let collisionParticles = [];

    function startAccelerator() {
      acceleratorRunning = true;
      const energy = parseInt(document.getElementById('energySlider').value);
      const intensity = parseInt(document.getElementById('intensitySlider').value);
      
      addToLog(`Acelerador iniciado - Energia: ${energy} GeV, Intensidade: ${intensity}%`);
      
      function generateParticles() {
        if (!acceleratorRunning) return;
        
        const count = Math.floor(intensity / 25);
        for (let i = 0; i < count; i++) {
          particles.push(new Particle(selectedParticle, energy));
        }
        
        setTimeout(generateParticles, 1000 - (intensity * 8));
      }
      
      generateParticles();
      animateParticles();
    }

    function stopAccelerator() {
      acceleratorRunning = false;
      addToLog('Acelerador parado');
    }

    function selectParticle(type) {
      selectedParticle = type;
      const names = {
        'proton': 'Pr√≥ton',
        'electron': 'El√©tron', 
        'alpha': 'Part√≠cula Alpha',
        'photon': 'F√≥ton'
      };
      addToLog(`Part√≠cula selecionada: ${names[type]}`);
    }

    function collideParticles() {
      if (particles.length < 2) {
        addToLog('‚ö†Ô∏è Necess√°rio pelo menos 2 part√≠culas para colis√£o');
        return;
      }

      addToLog('üí• COLIS√ÉO DETETADA! Gerando part√≠culas secund√°rias...');
      
      // Simular produ√ß√£o de part√≠culas na colis√£o
      const collisionX = particleCanvas.width / 2;
      const collisionY = particleCanvas.height / 2;
      
      const secondaryParticles = [
        new Particle('electron', 5),
        new Particle('photon', 8),
        new Particle('proton', 12)
      ];
      
      secondaryParticles.forEach(p => {
        p.x = collisionX;
        p.y = collisionY;
        p.vx = (Math.random() - 0.5) * 4;
        collisionParticles.push(p);
      });

      // Efeito visual da colis√£o
      drawCollisionEffect(collisionX, collisionY);
    }

    function drawCollisionEffect(x, y) {
      // Explos√£o de part√≠culas
      for (let i = 0; i < 10; i++) {
        setTimeout(() => {
          const angle = (i / 10) * Math.PI * 2;
          const spark = {
            x: x,
            y: y,
            vx: Math.cos(angle) * 3,
            vy: Math.sin(angle) * 3,
            life: 30
          };
          
          function animateSpark() {
            spark.x += spark.vx;
            spark.y += spark.vy;
            spark.life--;
            
            particleCtx.fillStyle = `rgba(255, 235, 59, ${spark.life / 30})`;
            particleCtx.beginPath();
            particleCtx.arc(spark.x, spark.y, 2, 0, Math.PI * 2);
            particleCtx.fill();
            
            if (spark.life > 0) {
              requestAnimationFrame(animateSpark);
            }
          }
          
          animateSpark();
        }, i * 50);
      }
    }

    function animateParticles() {
      particleCtx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
      
      // Desenhar detetores
      drawDetectors();
      
      // Atualizar e desenhar part√≠culas do acelerador
      particles = particles.filter(particle => {
        const alive = particle.update();
        if (alive) {
          particle.draw();
          
          // Detetar colis√µes com o detetor
          if (particle.x > particleCanvas.width - 100 && particle.x < particleCanvas.width - 40) {
            if (Math.random() < 0.02) {
              addToLog(`üì° Part√≠cula ${particle.type} detetada no calor√≠metro`);
            }
          }
        }
        return alive;
      });
      
      // Atualizar e desenhar part√≠culas de colis√£o
      collisionParticles = collisionParticles.filter(particle => {
        particle.update();
        particle.draw();
        return particle.x > 0 && particle.x < particleCanvas.width && particle.y > 0 && particle.y < particleCanvas.height;
      });
      
      if (acceleratorRunning || particles.length > 0 || collisionParticles.length > 0) {
        requestAnimationFrame(animateParticles);
      }
    }

    function drawDetectors() {
      // Desenhar campo magn√©tico
      if (magneticField) {
        particleCtx.strokeStyle = 'rgba(79, 195, 247, 0.3)';
        particleCtx.setLineDash([5, 5]);
        particleCtx.beginPath();
        particleCtx.moveTo(0, particleCanvas.height / 3);
        particleCtx.lineTo(particleCanvas.width, particleCanvas.height / 3);
        particleCtx.moveTo(0, particleCanvas.height * 2/3);
        particleCtx.lineTo(particleCanvas.width, particleCanvas.height * 2/3);
        particleCtx.stroke();
        particleCtx.setLineDash([]);
      }
      
      // Desenhar calor√≠metro
      if (calorimeter) {
        particleCtx.fillStyle = 'rgba(229, 115, 115, 0.2)';
        particleCtx.fillRect(particleCanvas.width - 100, 0, 60, particleCanvas.height);
      }
    }

    function toggleMagneticField() {
      magneticField = !magneticField;
      addToLog(`Campo magn√©tico ${magneticField ? 'ativado' : 'desativado'}`);
    }

    function toggleCalorimeter() {
      calorimeter = !calorimeter;
      addToLog(`Calor√≠metro ${calorimeter ? 'ativado' : 'desativado'}`);
    }

    function resetDetectors() {
      magneticField = false;
      calorimeter = false;
      particles = [];
      collisionParticles = [];
      addToLog('Sistema de detetores resetado');
    }

    function analyzeEvent() {
      const analyses = [
        "üìä An√°lise: B√≥son de Higgs detectado!",
        "üìä An√°lise: Quark top produzido",
        "üìä An√°lise: Decaimento de m√∫on observado", 
        "üìä An√°lise: Jatos hadr√¥nicos identificados",
        "üìä An√°lise: F√≥ton de alta energia"
      ];
      const randomAnalysis = analyses[Math.floor(Math.random() * analyses.length)];
      addToLog(randomAnalysis);
    }

    function addToLog(message) {
      const log = document.getElementById('particleLog');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    function clearLog() {
      document.getElementById('particleLog').innerHTML = '<div class="log-entry">Log limpo</div>';
    }

    // ====== ATUALIZA√á√ïES DO SISTEMA NUCLEAR ======
    function simulateAlphaDecay() {
      if (!currentAtom || currentAtom.atomicNumber < 83) {
        alert("Decaimento Alpha ocorre em elementos pesados (Z ‚â• 83). Tente Pol√¥nio-210.");
        return;
      }
      document.getElementById('info').innerHTML += `
        <hr>
        <p style="color:#ff9800"><strong>Decaimento Alpha!</strong></p>
        <p>${currentAtom.symbol}-${currentAtom.massNumber} ‚Üí ${getSymbol(currentAtom.atomicNumber - 2)}-${currentAtom.massNumber - 4} + Œ±</p>
        <p>Part√≠cula alpha (‚Å¥He) emitida com ~5 MeV</p>
      `;
    }

    function simulateBetaDecay() {
      if (!currentAtom) {
        alert("Crie um √°tomo primeiro.");
        return;
      }
      document.getElementById('info').innerHTML += `
        <hr>
        <p style="color:#ff5252"><strong>Decaimento Beta!</strong></p>
        <p>n ‚Üí p + e‚Åª + ŒΩÃÖ‚Çë (antineutrino do el√©tron)</p>
        <p>El√©tron de alta energia emitido</p>
      `;
    }

    function exportData() {
      if (!currentAtom) {
        alert("Crie um √°tomo primeiro para exportar dados.");
        return;
      }
      const data = {
        elemento: currentAtom.symbol,
        protons: currentAtom.protons,
        neutrons: currentAtom.neutrons,
        electrons: currentAtom.electrons,
        massa: currentAtom.massNumber,
        carga: currentAtom.charge,
        estavel: currentAtom.isStable,
        configuracao: currentAtom.getElectronConfiguration()
      };
      const dataStr = JSON.stringify(data, null, 2);
      const blob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `atom_${currentAtom.symbol}_${currentAtom.massNumber}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // ====== INICIALIZA√á√ÉO DOS SLIDERS ======
    document.getElementById('energySlider').addEventListener('input', function(e) {
      document.getElementById('energyValue').textContent = e.target.value + ' GeV';
    });

    document.getElementById('intensitySlider').addEventListener('input', function(e) {
      document.getElementById('intensityValue').textContent = e.target.value + '%';
    });

    // Inicializar canvas de part√≠culas
    animateParticles();
  </script>
</body>
</html>
